<!DOCTYPE html>
<html lang="{{ get_locale() }}">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ _('Nivana - Mental Health Support') }}{% endblock %}</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">

    <style>
        /* Sidebar + Content Layout Fix */
        .content {
            margin-left: 250px;
            transition: margin-left 0.3s ease;
        }
        .sidebar.collapsed + .content,
        .content.expanded {
            margin-left: 70px;
        }

        /* Hide logo + text when collapsed */
        .sidebar.collapsed .logo-section {
            display: none !important;
        }
    </style>

    {% block extra_head %}{% endblock %}
</head>
<body>
    <!-- Sidebar -->
    <nav id="sidebar" class="sidebar d-flex flex-column">
        <div class="sidebar-header d-flex align-items-center justify-content-between px-3 py-2">
            <a class="navbar-brand d-flex align-items-center logo-section" href="{{ url_for('index') }}">
                <i class="fas fa-heart me-2"></i>
                <span class="label">Nivana</span>
            </a>
            <button class="btn btn-sm btn-toggle-sidebar" id="sidebarCollapse" aria-label="Toggle sidebar" aria-expanded="true" aria-controls="sidebar">
                <i class="fas fa-bars"></i>
            </button>
        </div>

        <!-- Menu -->
        <div class="sidebar-menu flex-grow-1 mt-3">
        <ul class="list-unstyled">
            {% if current_user.is_authenticated %}
                {% if current_user.role == 'counsellor' %}
                    <li><a href="{{ url_for('counsellor_dashboard') }}"><i class="fas fa-tachometer-alt icon"></i><span class="label">{{ _('Dashboard') }}</span></a></li>
                {% else %}
                    <li><a href="{{ url_for('dashboard') }}"><i class="fas fa-tachometer-alt icon"></i><span class="label">{{ _('Dashboard') }}</span></a></li>
                    <li><a href="{{ url_for('chatbot') }}"><img id="chatbot-icon" src="{{ url_for('static', filename='images/bot.png') }}" class="icon" style="width: 20px; height: 20px; margin-right: 10px;"><span class="label">{{ _('Chat Support') }}</span></a></li>
                    <li><a href="{{ url_for('perenall') }}"><i class="fas fa-seedling icon"></i><span class="label"> {{ _('Kalpavriksha') }}</span></a></li>
                    <li><a href="{{ url_for('assessments') }}"><i class="fas fa-clipboard-list icon"></i><span class="label">{{ _('Assessments') }}</span></a></li>
                    <li><a href="{{ url_for('meditation') }}"><i class="fas fa-leaf icon"></i><span class="label">{{ _('Meditation') }}</span></a></li>
                    <li><a href="{{ url_for('vr_meditation') }}"><i class="fas fa-vr-cardboard icon"></i><span class="label"> {{ _('VR Meditation') }}</span></a></li>
                    <li><a href="{{ url_for('ar_breathing') }}"><i class="fas fa-mobile-alt icon"></i><span class="label"> {{ _('AR Breathing') }}</span></a></li>
                    <li><a href="{{ url_for('resources') }}"><i class="fas fa-book-medical icon"></i><span class="label">{{ _('Resources') }}</span></a></li>
                    <li><a href="{{ url_for('venting_room') }}"><i class="fas fa-fire icon"></i><span class="label">{{ _('Private Venting Room') }}</span></a></li>
                    <li><a href="{{ url_for('sound_venting') }}"><i class="fas fa-microphone icon"></i><span class="label"> {{ _('Sound Venting') }}</span></a></li>
                    <li><a href="{{ url_for('venting_hall') }}"><i class="fas fa-users icon"></i><span class="label">{{ _('Community Support') }}</span></a></li>
                    <li><a href="{{ url_for('consultation') }}"><i class="fas fa-user-md icon"></i><span class="label">{{ _('Consultation') }}</span></a></li>
                    <li><a href="{{ url_for('routine') }}"><i class="fas fa-calendar-alt icon"></i><span class="label">{{ _('Routine') }}</span></a></li>
                    {% if current_user.role in ['teacher', 'admin'] %}
                    <li><a href="{{ url_for('mentor_dashboard') }}"><i class="fas fa-chart-bar icon"></i><span class="label">{{ _('Mentor Dashboard') }}</span></a></li>
                    {% endif %}
                {% endif %}
            {% endif %}
        </ul>
</div>

        <!-- Footer -->
        <div class="sidebar-footer mt-auto">
            <div class="language-switcher px-3 py-2 mb-2">
                <div class="d-flex justify-content-center">
                    <div class="btn-group btn-group-sm" role="group">
                        <a href="{{ url_for('set_language', language='en') }}" class="btn btn-outline-secondary {% if session.language == 'en' or not session.language %}active{% endif %}">ðŸ‡ºðŸ‡¸ EN</a>
                        <a href="{{ url_for('set_language', language='hi') }}" class="btn btn-outline-secondary {% if session.language == 'hi' %}active{% endif %}">ðŸ‡®ðŸ‡³ à¤¹à¤¿à¤‚</a>
                    </div>
                </div>
            </div>
            {% if current_user.is_authenticated %}
                <div class="user-info px-3 py-2">
                    <i class="fas fa-user icon"></i>
                    <span class="label">{{ current_user.username }}</span>
                    {% if current_user.login_streak > 0 %}
                        <span class="badge bg-success">{{ current_user.login_streak }} {{ _('days') }}</span>
                    {% endif %}
                </div>
                <a class="btn btn-sm btn-danger w-100 mt-2" href="{{ url_for('logout') }}">
                    <i class="fas fa-sign-out-alt icon" style="color: white;"></i>
                    <span class="label" style="color: white; font-weight: bold;">{{ _('Logout') }}</span>
                </a>
            {% else %}
                <a class="btn btn-sm btn-primary w-100 mb-2" href="{{ url_for('login') }}">
                    <i class="fas fa-sign-in-alt icon"></i>
                    <span class="label">{{ _('Login') }}</span>
                </a>
                <a class="btn btn-sm btn-success w-100" href="{{ url_for('register') }}">
                    <i class="fas fa-user-plus icon"></i>
                    <span class="label">{{ _('Register') }}</span>
                </a>
            {% endif %}
        </div>
    </nav>

    <!-- Page Content -->
    <div id="content" class="content">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1100;">
                    {% for category, message in messages %}
                        <div class="toast align-items-center text-bg-{{ 'danger' if category == 'error' else category }} border-0 show mb-2" role="alert">
                            <div class="d-flex">
                                <div class="toast-body">{{ message }}</div>
                                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <main class="container-fluid py-4">
            {% block content %}{% endblock %}
        </main>

        <footer class="text-center py-4 mt-5">
            <p class="text-muted mb-2"><i class="fas fa-heart text-danger"></i> MindCare - Your Mental Health Companion</p>
            <p class="small text-muted"><strong>Crisis Hotlines:</strong> National Suicide Prevention Lifeline: 988 | Crisis Text Line: Text HOME to 741741</p>
        </footer>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Sidebar Toggle JS -->
    <script>
const sidebar = document.getElementById("sidebar");
const content = document.getElementById("content");
const toggleBtn = document.getElementById("sidebarCollapse");

toggleBtn.addEventListener("click", function () {
    if (window.innerWidth <= 768) {
        sidebar.classList.toggle("open");
    } else {
        sidebar.classList.toggle("collapsed");
        content.classList.toggle("expanded");
        initTooltips(); // update tooltips on toggle
    }
    toggleBtn.setAttribute("aria-expanded", !sidebar.classList.contains("collapsed"));
});

// Auto-close sidebar on link click in mobile
document.querySelectorAll(".sidebar-menu a").forEach(link => {
    link.addEventListener("click", () => {
        if (window.innerWidth <= 768) sidebar.classList.remove("open");
    });
});

// Initialize Bootstrap tooltips for collapsed sidebar
function initTooltips() {
    document.querySelectorAll('.sidebar-menu a').forEach(link => {
        if (link._tooltip) link._tooltip.dispose(); // destroy old tooltip
        if (sidebar.classList.contains('collapsed')) {
            link._tooltip = new bootstrap.Tooltip(link, {
                title: link.querySelector('.label') ? link.querySelector('.label').innerText : '',
                placement: 'right',
                trigger: 'hover',
                container: 'body'
            });
        }
    });
}

// Initialize once on page load
initTooltips();

        </script>
        
    {% block extra_scripts %}{% endblock %}
</body>
</html>
