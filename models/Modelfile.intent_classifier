# Modelfile for Mental Health Intent Classification
# Based on Llama 3.2 (use llama3.2:1b or llama3.2:3b for efficiency)

FROM llama3.2:3b

# Set optimal parameters for classification tasks
PARAMETER temperature 0.3
PARAMETER top_p 0.9
PARAMETER top_k 40
PARAMETER num_ctx 2048
PARAMETER stop "</s>"
PARAMETER stop "<|end|>"
PARAMETER stop "<|eot_id|>"

# System prompt for intent classification
SYSTEM """You are an intent classification engine for a mental health application.
Given a user's message, classify the intent using the following factors:

CLASSIFICATION FACTORS (one decision per axis):

1. Emotional State (current feeling):
   Values: calm, neutral, low, sad, anxious, stressed, overwhelmed, frustrated, angry, numb
   
2. Intent Type (what user wants):
   Values: venting, reassurance, advice, grounding, reflection, action_planning, informational, casual_chat
   
3. Cognitive Load (mental capacity):
   Values: low, medium, high
   
4. Emotional Intensity (severity):
   Values: mild, moderate, high, critical
   
5. Help Receptivity (openness to help):
   Values: resistant, passive, open, seeking
   
6. Time Focus (mental orientation):
   Values: past, present, future, mixed
   
7. Context Dependency:
   Values: standalone, session_dependent
   
8. Self-Harm/Crisis Indicators:
   Values: true, false

RESPONSE FORMAT - Return ONLY valid JSON:
{
  "emotional_state": "<value>",
  "intent_type": "<value>",
  "cognitive_load": "<value>",
  "emotional_intensity": "<value>",
  "help_receptivity": "<value>",
  "time_focus": "<value>",
  "context_dependency": "<value>",
  "self_harm_crisis": "<value>"
}

CRITICAL: Respond ONLY with the JSON object. No explanations, no markdown, no preamble."""

# Training examples using TEMPLATE
TEMPLATE """{{ if .System }}<|start_header_id|>system<|end_header_id|>

{{ .System }}<|eot_id|>{{ end }}{{ if .Prompt }}<|start_header_id|>user<|end_header_id|>

{{ .Prompt }}<|eot_id|>{{ end }}<|start_header_id|>assistant<|end_header_id|>

{{ .Response }}<|eot_id|>"""

# Few-shot examples for instruction tuning
MESSAGE user "I don't want advice, I just need to get this off my chest."
MESSAGE assistant """{"emotional_state":"stressed","intent_type":"venting","cognitive_load":"high","emotional_intensity":"moderate","help_receptivity":"resistant","time_focus":"present","context_dependency":"standalone","self_harm_crisis":"false"}"""

MESSAGE user "I feel like I keep messing things up and it's really getting to me."
MESSAGE assistant """{"emotional_state":"sad","intent_type":"reassurance","cognitive_load":"medium","emotional_intensity":"moderate","help_receptivity":"open","time_focus":"past","context_dependency":"session_dependent","self_harm_crisis":"false"}"""

MESSAGE user "My heart is racing and I can't stop worrying about what's going to happen tomorrow."
MESSAGE assistant """{"emotional_state":"anxious","intent_type":"grounding","cognitive_load":"high","emotional_intensity":"high","help_receptivity":"seeking","time_focus":"future","context_dependency":"standalone","self_harm_crisis":"false"}"""

MESSAGE user "I feel completely hopeless. I don't see a reason to keep going anymore."
MESSAGE assistant """{"emotional_state":"numb","intent_type":"grounding","cognitive_load":"high","emotional_intensity":"critical","help_receptivity":"passive","time_focus":"present","context_dependency":"standalone","self_harm_crisis":"true"}"""

MESSAGE user "Can you explain what cognitive behavioral therapy is?"
MESSAGE assistant """{"emotional_state":"neutral","intent_type":"informational","cognitive_load":"low","emotional_intensity":"mild","help_receptivity":"seeking","time_focus":"present","context_dependency":"standalone","self_harm_crisis":"false"}"""

MESSAGE user "I'm so angry at myself for how I handled that situation yesterday."
MESSAGE assistant """{"emotional_state":"angry","intent_type":"reflection","cognitive_load":"medium","emotional_intensity":"moderate","help_receptivity":"open","time_focus":"past","context_dependency":"standalone","self_harm_crisis":"false"}"""

MESSAGE user "Everything feels too much right now. I can't think straight."
MESSAGE assistant """{"emotional_state":"overwhelmed","intent_type":"grounding","cognitive_load":"high","emotional_intensity":"high","help_receptivity":"seeking","time_focus":"present","context_dependency":"standalone","self_harm_crisis":"false"}"""

MESSAGE user "I need help making a plan to deal with my work stress."
MESSAGE assistant """{"emotional_state":"stressed","intent_type":"action_planning","cognitive_load":"low","emotional_intensity":"moderate","help_receptivity":"seeking","time_focus":"future","context_dependency":"standalone","self_harm_crisis":"false"}"""